// ---------- Generators & datasource ----------
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ---------- Enums ----------
enum PaymentMethod {
  qris
  bank_transfer
}

enum Service {
  economy
  express
  economy_standard
  economy_plus
  packet_premium
}

enum LocalDeliveryStatus {
  in_progress
  on_the_way
  pending_payment
  paid
}

enum DeliveryStatus {
  not_yet_create_label
  label_confirmed
  ready_to_send
  tracking_received
}

// ---------- Core people ----------
model Customer {
  id         String   @id @default(cuid())
  name       String
  phone      String   @unique
  phoneCode  String   @default("+62")
  shopeeName String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  orders     Order[]

  @@index([phone])
}

model Buyer {
  id                String    @id @default(uuid())
  buyerFullName     String 
  buyerAddress1     String 
  buyerAddress2     String 
  buyerCity         String 
  buyerState        String 
  buyerZip          String 
  buyerCountry      String 
  buyerEmail        String @default("") 
  buyerPhone        String
  phoneCode         String @default("")  
  
  srns   BuyerSRN[]
  orders Order[]

  // Dedupe “person” primarily by phone per country
  @@unique([buyerCountry, buyerPhone])
  @@index([buyerEmail])
  @@index([buyerFullName, buyerCity])
}

model BuyerSRN {
  saleRecordNumber Int     @id
  buyerId          String
  buyer            Buyer   @relation(fields: [buyerId], references: [id], onDelete: Cascade)

  kurasiShipmentId String?  @unique// e.g. "KRS2205130138"
  trackingNumber   String?  // e.g. "LQ082058163SG"
  trackingSlug     String?  // e.g. "quantium"

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([kurasiShipmentId])
  @@index([trackingNumber])
  @@index([trackingSlug])
}

// ---------- Orders & package ----------
model Order {
  id       String   @id @default(cuid())
  placedAt DateTime
  notes    String?

  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Restrict)
  customerId String

  // Link to Buyer (int)
  buyerId String
  buyer   Buyer @relation(fields: [buyerId], references: [id], onDelete: Restrict)

  package   PackageDetail @relation(fields: [packageId], references: [id], onDelete: Cascade)
  packageId String        @unique

  quotedAmountMinor Int?
  shippingPriceMinor Int?
  currency          String?
  pricingSource     String?

  localStatus    LocalDeliveryStatus @default(in_progress)
  deliveryStatus DeliveryStatus      @default(not_yet_create_label)
  paymentMethod  PaymentMethod       @default(qris)

  externalRef  String?
  labelId      String?
  trackingLink String?
  krsTrackingNumber String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt


  @@index([placedAt])
  @@index([localStatus, deliveryStatus])
  @@index([customerId])
  @@index([buyerId])
}

model PackageDetail {
  id              String   @id @default(cuid())
  weightGrams     Int?
  totalValue      Decimal?
  packageDescription String?
  lengthCm        Decimal?
  widthCm         Decimal?
  heightCm        Decimal?
  volumetricGrams Int?
  service         Service

  // Redundant package-level details
  currency        String?
  sku             String?
  hsCode          String?
  countryOfOrigin String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  order           Order?
}

